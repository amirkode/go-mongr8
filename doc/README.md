# Go-mongr8
Go-mongr8 provides functionalities in serveral CLI commands such as initating migration folder, create a schema template, appply migration, etc.

First, we need to install this package to be globally accessible as command `go-mongr8` :
```sh
go install github.com/amirkode/go-mongr8@latest
```

After installing, the package will be automatically built as an executable and avaible in the default `$PATH` environment variable. Now, the command `go-mongr8` should be avaiable in CLI interface.

## Operation
### Flags
Go-mongr8 command accepts flags for migration options. These are available flags in go-mongr8:

|          flag         |   type   | value | usage |
|-----------------------|----------|-------|-------|
| use-sorted-schema     | boolean  | no    | Preserves the field position as in schema definition |
| use-force-conversion  | boolean  | no    | Force conversion on unsupported types|
| use-schema-validation | boolean  | no    | Apply schema validation on migration|
| use-transaction       | boolean  | no    | Use transaction while working with MongoDB|
| desc                  | string   | yes   | Define a description in a migration vesion|

### Command: `init-migration`
To work with migration, default `mongr8` folder must be initiated. It includes all required files and folders for migration. 

You can initiate the `mongr8` folder by executing this command inside project root directory:
```sh
> go-mongr8 init-migration
```
This will generate a folder with this structure:
```
[your project root]/
├── mongr8/
|   ├── cmd/
|       ├── contains migration commands
|   ├── collection/
|       ├── contains collection schema definitions
|   ├── config/
|       ├── contains some setup files
|   ├── migration/
|       ├── contains some migration files
```

### Command: `create-collection`
To declare a schema in migration, you need to have a collection schema template.
You can generate it by executing:
```sh
> go-mongr8 create-collection [collection name]
```
i.e:
```sh
> go-mongr8 create-collection users
```
This will create collection schema file in `mongr8/collection/users.go`. After that, you can freely declare your schema. Complete documentation can be found [here]().

### Command: `generate-migration`
**Go-mongr8** use versioned migration to keep track of changes history. Each migration will be declared as a migration file generated by **go-mongr8** automatically in `mongr8/migration`, it considers the aggregated all migration files schema and the latest schema defined in `mongr8/collection`.

You can generate migration file by executing:
```sh
> go-mongr8 generate-migration
```
This will create a new migration file in `mongr8/migration`.

### Command: `apply-migration`
To apply migration, you need to have the migration files ready. And then, make sure of database cofiguration is already set in `mongr8/config/config.go`.

You can run the migration by executing:
```sh
> go-mongr8 apply-migration
```
This should apply all migrations with new IDs.

### Command: `consolidate-migration`
Coming soon

### Command: `rollback-migration`
Coming soon

### Open Command
Some commands can be directly run from `mongr8/cmd` folder. This allows pre-built commands  are made to execute later, and makes benefit of some usecases such running the pre-built commands on the deployment.

These are support commands:
- Apply migration: `mongr8/cmd/apply`
- Consolidate migration: `mongr8/cmd/consolidate`
- Generate migration: `mongr8/cmd/generate`

You can either run or build those commands on your preference.